#!/bin/env bash

usage() {
  printf "Usage: $0\n\n\t-h, --help\tDisplay usage instructions\n\t-n, --next\tNext song\n\t-p, --prev\tPrevious song\n\t-t, --toggle\tPlay/Pause\n\t-s, --stop\tStop\n\t    --pause\tPause song\n\t    --play\tPlay song\n\t-u, --url\tOpen URL\n"
  return 1
}

send() {
	command dbus-send --print-reply --dest=org.mpris.MediaPlayer2.ncspot /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player."$1"
}

url() { #__ We need some parsing logic for URLs __#
	[ -z "$*" ] && usage |
	type=track # default
	if [[ $* == *"open.spotify.com/playlist/"* ]]; then
		type=playlist
	elif [[ $* == *"open.spotify.com/album/"* ]]; then
		type=album
	fi
	key=$(echo $* | sed 's:.*/::' | cut -c 1-22)
	printf "%s:%s\n\n" "$type" "$key"
	command dbus-send --print-reply --dest=org.mpris.MediaPlayer2.ncspot /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.OpenUri string:ncspot:$type:$key
}

error() {
  printf "$@\n\n" 1>&2
  usage
}


if [ -z "$1" ] ; then
	error "No arguments given, exiting..."
else
  case $1 in
	-h|--help)
		usage;;
	-n|--next)
		send Next;;
	-p|--prev)
		send Previous;;
	-s|--stop)
		send Stop;;
	-t|--toggle)
		send PlayPause;;
	--play)
		send Play;;
	--pause)
		send Pause;;
	-u|--url)
		url "$2";;
	*)
		error "Invalid option: $1";;
  esac
fi
